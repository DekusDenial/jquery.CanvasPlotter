/*! jQuery Canvasplotter - v0.1.0 - 2012-04-15
* https://github.com/DekusDenial/jquery.CanvasPlotter
* Copyright (c) 2012 DekusDenial; Licensed MIT */
typeof Object.create!="function"&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),function(a,b,c,d){var e={init:function(b,c){this.el=b,this.$el=a(b),this.config=a.extend({},a.fn.canvasPlotter.defaults,c),this.dataSource=this.$el.data("source")||this.config.dataSource,this.dataSource=this.dataSource.indexOf("#")>-1?this.dataSource:"#"+this.dataSource,this.fetchData()},fetchData:function(){this.xValue=[],this.yValue=[];var b=this,c=a(this.config.dataSource),d=c.find("th");this.xLabel=d[0],this.yLabel=d[1],c.find("tr td").each(function(a,c){a&1?b.yValue.push(c.innerText):b.xValue.push(c.innerText)}),this.prepareCanvas()},prepareCanvas:function(){this.$cv=this.$el.append("<canvas>").find("canvas"),this.$cv[0].height=this.config.canvasHeight,this.$cv[0].width=this.yValue.length*(this.config.barWidth+this.config.barGap)+this.config.barGap*2;if(!(this.cvContext=this.$cv[0].getContext("2d")))throw"Sorry, something wrong with canvas in your browser!";this.normalizeData(),this.drawLabels(),this.config.animated?this.animatedPlotBars():this.plotBars()},normalizeData:function(){this.maxValue=Math.round(Math.max.apply(Math,this.yValue)*(1+this.config.constants.scaleFactor)),this.minValue=Math.min.apply(Math,this.yValue)-Math.round(this.maxValue*this.config.constants.scaleFactor)},drawLabels:function(){var a=this.cvContext;a.save(),a.fillStyle="#fff",a.fillRect(this.config.barGap+this.config.constants.xTickOffset,0,this.$cv[0].width,this.config.constants.maxHeight+Math.round(this.config.constants.yTickOffset/2));var b,c=this.xValue.length;a.font="11px Helvetica, Arial, sans-serif",a.fillStyle="#000";for(b=0;b<c;b++)a.fillText(this.xValue[b],this.utils.posX.call(this,b),this.config.constants.maxHeight+this.config.constants.bottomOffset);for(b=0,c=this.config.numYTicks;b<c+1;b++){var d=Math.round(this.maxValue/this.config.numYTicks*b),e=(this.maxValue.toString().length-d.toString().length)*this.config.constants.yTickAdjustFactor;a.fillText(d,this.config.constants.xTickOffset+e,this.utils.posY.call(this,d)+this.config.constants.yTickOffset),this.drawGrids(a,this.config.constants.xTickOffset,this.utils.posY.call(this,d)+Math.round(this.config.constants.yTickOffset/2))}a.restore()},drawGrids:function(a,b,c){a.save(),a.fillStyle="#ccc",a.fillRect(b+20,c,this.$cv[0].width,1),a.fillStyle="#111",a.fillRect(this.config.barGap+this.config.constants.xTickOffset,this.config.constants.maxHeight+Math.round(this.config.constants.yTickOffset/2),this.$cv[0].width,1),a.fillRect(this.config.barGap+this.config.constants.xTickOffset,0,1,this.config.constants.maxHeight+Math.round(this.config.constants.yTickOffset/2)),a.restore()},plotBars:function(){var a=0,b=this.yValue.length,c=this.cvContext;c.save(),c.lineWidth=1;for(;a<b;a++){c.fillStyle="rgba(0,0,0,0.5)",c.fillRect(this.utils.posX.call(this,a)+3,this.utils.posY.call(this,this.yValue[a])+Math.round(this.config.constants.yTickOffset/2)+3,this.config.barWidth,this.utils.scale.call(this,this.yValue[a])-3),c.fillStyle="#8DC900",c.fillRect(this.utils.posX.call(this,a),this.utils.posY.call(this,this.yValue[a])+Math.round(this.config.constants.yTickOffset/2),this.config.barWidth,this.utils.scale.call(this,this.yValue[a])),c.fillStyle="#000";var d=Math.round(this.config.barWidth/2-this.yValue[a].toString().length*this.config.constants.yTickAdjustFactor/2);c.fillText(this.yValue[a],this.utils.posX.call(this,a)+d,this.utils.posY.call(this,this.yValue[a]))}c.restore()},animatedPlotBars:function(){this.$cv.addClass("bar-animated"),this.plotBars()},utils:{posX:function(a){return a*this.config.barWidth+(a+2)*this.config.barGap+this.config.constants.xTickOffset},posY:function(a){return this.config.constants.maxHeight-this.utils.scale.call(this,a)},scale:function(a){return Math.round(a/this.maxValue*this.config.constants.maxHeight)}}};a.fn.canvasPlotter=function(a){return this.each(function(){var b=Object.create(e);b.init(this,a)})},a.fn.canvasPlotter.defaults={animated:!1,dataSource:"table#dataSource",barGap:20,barWidth:25,canvasHeight:200,numYTicks:10,constants:{bottomOffset:20,xLabelOffset:15,yTickOffset:10,yTickAdjustFactor:6,xTickOffset:5,scaleFactor:.1}},a.fn.canvasPlotter.defaults.constants.maxHeight=a.fn.canvasPlotter.defaults.canvasHeight-a.fn.canvasPlotter.defaults.constants.bottomOffset}(jQuery,window,document)